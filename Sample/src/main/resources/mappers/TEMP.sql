CREATE TABLE BOARD(
	BNO INT NOT NULL,	-- 게시판 고유 번호
	TITLE VARCHAR(100),	-- 게시글 제목
	CONTENT VARCHAR(1000),	-- 게시글 내용
	WRITER VARCHAR(100),	-- 글쓴이
	PRIMARY KEY (BNO)	-- 게시판 번호 기본키 지정
);

DROP TABLE BOARD;

CREATE TABLE MEMBER(
	ID VARCHAR(12) NOT NULL,	-- 아이디
	PASSWORD VARCHAR(12) NOT NULL,	-- 비밀번호
	NAME VARCHAR(10) NOT NULL,	-- 이름
	DATE_OF_BIRTH DATE NOT NULL,	-- 생일
	PHONE_NUMBER VARCHAR(13) NOT NULL, -- 폰번호
	EMAIL VARCHAR(13) NOT NULL,	-- 이메일
	PRIMARY KEY(ID)	-- ID 기본키 지정
);

-- BOARD_SEQ 시퀀스 생성
CREATE SEQUENCE BOARD_SEQ
    START WITH 1       -- 시퀀스 시작값 설정
    INCREMENT BY 1     -- 시퀀스 값 1씩 증가
    NOCACHE;           -- 캐시 사용 안함

-- 트리거를 사용하여 BNO 값 자동 할당
CREATE OR REPLACE TRIGGER BOARD_BNO_TRIGGER
    BEFORE INSERT ON BOARD
    FOR EACH ROW
BEGIN
    -- 첫 번째 게시글 삽입 시 BNO 값을 0으로 지정
    IF :NEW.BNO IS NULL THEN
        :NEW.BNO := 0; -- 첫 게시글 삽입 시 BNO를 0으로 설정
    ELSE
        -- 이후 게시글들은 시퀀스 값을 사용
        :NEW.BNO := BOARD_SEQ.NEXTVAL;
    END IF;
END;


CREATE OR REPLACE TRIGGER BOARD_BNO_TRIGGER
    BEFORE INSERT ON BOARD
    FOR EACH ROW
BEGIN
    -- 첫 번째 게시글 삽입 시 BNO 값을 시퀀스로 설정
    IF :NEW.BNO IS NULL THEN
        :NEW.BNO := BOARD_SEQ.NEXTVAL; -- 시퀀스 값 사용
    END IF;
END;


DROP TRIGGER BOARD_BNO_TRIGGER;

INSERT INTO BOARD (BNO, TITLE, CONTENT, WRITER) VALUES (3, '제목333', '글 내용333', '익명3');

DELETE FROM BOARD;

DROP SEQUENCE BOARD_SEQ;

ALTER SEQUENCE BOARD_SEQ RESTART START WITH 1;

SELECT * FROM USER_TRIGGERS WHERE TRIGGER_NAME = 'BOARD_BNO_TRIGGER';

SELECT BOARD_SEQ.CURRVAL FROM DUAL;
SELECT BOARD_SEQ.NEXTVAL FROM DUAL;

-- 기본키 제약 삭제
ALTER TABLE BOARD DROP PRIMARY KEY;

-- bno 칼럼 삭제
ALTER TABLE BOARD DROP COLUMN bno;

SELECT * FROM BOARD;
COMMIT;